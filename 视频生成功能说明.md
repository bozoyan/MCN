# 视频生成功能使用说明 (增强版)

## 功能概述
这个是在主程序的左侧导航栏中新增的"视频生成"按钮，点击后右侧主窗口会显示全新设计的视频生成界面。该功能基于 BizyAir API 将图片转换为视频，支持批量处理、多密钥并发、拖拽上传等高级功能。

## 🌙 深色主题界面设计

### 大气时尚的深色风格
- **专业的深色配色**: 主背景#1e1e1e，卡片背景#2a2a2a，营造专业科技感
- **优雅的层次感**: 通过#333333和#404040的深浅变化创造视觉层次
- **高对比度设计**: 白色文字在深色背景上确保最佳可读性
- **时尚的蓝色强调**: #4a90e2主题色提供现代感，绿色和红色用于状态指示
- **简约而不简单**: 去除冗余装饰，专注于功能性和美观性并重

### 精致的交互体验
- **舒适的视觉过渡**: hover效果平滑自然，色彩过渡优雅
- **清晰的状态反馈**: 密钥状态、按钮状态都有明确的视觉指示
- **统一的圆角设计**: 6-8px圆角营造现代感，界面更加和谐
- **精心设计的间距**: 12px标准间距，既不拥挤也不过于松散

### 📸 增强的图片输入
- **简化的一行式选择**: 删除冗余标题，下拉菜单单行显示，界面更简洁
- **优化的拖拽区域**: 280×180px的合理尺寸，视觉更协调
- **清晰的视觉反馈**: 改进的拖拽区域样式，交互体验更佳
- **Base64编码**: 本地图片自动转换为Base64编码，优化传输效率

### 📋 批量任务管理
- **任务队列**: 支持添加多个任务到队列中
- **任务卡片**: 每个任务显示为独立的卡片，支持删除操作
- **批量执行**: 一键批量处理所有任务
- **进度追踪**: 实时显示批量处理进度

### 🔑 多密钥并发处理
- **多密钥支持**: 支持从文本文件加载多个API密钥
- **密钥轮换**: 自动轮换使用不同的密钥，提高并发效率
- **密钥管理**: 内置密钥文件管理界面
- **状态显示**: 实时显示可用密钥数量和状态
- **API密钥调用**：循环分配，避免冲突，可以同时并行处理

### ⚙️ API密钥管理
- **顶部设置按钮**: 快速访问密钥配置
- **文件选择**: 支持选择包含多个密钥的文本文件
- **测试功能**: 一键测试密钥文件是否有效
- **状态指示**: 实时显示密钥配置状态

### 🎬 视频生成功能
- **单个生成**: 快速生成单个视频
- **批量生成**: 同时通过不同的密钥并行处理多个任务，节省时间
- **参数配置**: 丰富的视频参数选项
- **预设模板**: 支持多种分辨率预设

### 📊 结果展示
- **视频URL显示**: 清晰显示生成的视频URL
- **一键播放**: 在浏览器中直接播放视频
- **下载功能**: 保存视频到本地
- **URL复制**: 一键复制视频URL到剪贴板

### 📝 优化的日志系统
- **高度自适应**: 日志显示区域自动调整高度
- **实时更新**: 操作过程实时记录
- **分类显示**: 不同类型的信息用不同图标标识
- **导出功能**: 支持导出日志到文本文件

## 🚀 使用步骤

### 基础配置

1. **打开视频生成界面**
   - 启动主程序 `storyboard_generator.py`
   - 在左侧导航栏点击"视频生成"按钮
   - 右侧主窗口会显示全新设计的视频生成界面

2. **配置API密钥（推荐）**
   - 点击顶部"密钥设置"按钮
   - 选择包含多个API密钥的文本文件（每行一个密钥）
   - 点击"测试密钥"验证配置
   - 保存设置，状态会显示"密钥: X个可用"
   

3. **配置视频参数**
   - 点击顶部"视频参数"按钮对话框区域设置宽度、高度和时长
   - 可以选择预设分辨率或输入自定义尺寸
   - 帧数会根据时长自动计算（16帧 = 1秒 + 封面帧）

### 单个视频生成

4. **选择图片输入方式**
   - 在"图片输入"区域选择"图片URL"并输入网络图片地址
   - 或选择"本地文件上传"，可以直接拖拽图片到上传区域或点击"选择图片文件"

5. **输入提示词**
   - 在"视频提示词"区域文本框中输入描述视频内容的文字

6. **生成视频**
   - 点击"单个生成"按钮开始生成
   - 观察右侧"视频列表"标签中的进度和日志信息
   

### 批量视频生成
- **多任务并发执行**：不要顺序处理，真正并行
- **独立API密钥分配**：循环分配不同密钥，避免冲突
- **独立计时器系统**：每个任务独立计时显示
- **实时进度跟踪**：显示每个任务的详细状态
- 
7. **添加到任务列表**
   - 配置好图片和参数后，点击"添加到任务列表"
   - 重复操作添加多个任务（每个任务使用相同的密钥文件配置）

8. **执行批量生成**
   - 在"批量任务管理"区域查看所有待处理任务
   - 可以单独删除不需要的任务
   - 点击"批量生成"按钮开始批量处理

并发批量生成功能具备：

  1. 🔄 多任务并发执行 - 不再顺序执行，真正并行处理
  2. 🔑 独立API密钥分配 - 每个任务循环分配不同密钥
  3. ⏱️ 独立计时器系统 - 每个任务独立计时，格式化显示
  4. 📊 实时进度跟踪 - 独立显示每个任务的进度和状态
  5. 🛡️ 错误隔离处理 - 单个任务失败不影响其他任务

  🎯 使用方式

  1. 启动程序： python storyboard_generator.py
  2. 进入视频生成： 点击左侧导航"视频生成"
  3. 配置密钥： 准备包含多个API密钥的文本文件
  4. 添加任务： 创建多个视频生成任务
  5. 并发执行： 点击"批量生成"，所有任务同时启动
  
9. **监控进度**
   - 查看顶部的批量进度条
   - 在"操作日志"标签中查看详细的执行过程
   - 不同任务会使用不同的API密钥并发处理

### 结果管理

10. **查看生成结果**
    - 在"视频列表"标签中查看所有生成的视频卡片
    - 每个卡片显示视频信息、URL和操作按钮

11. **操作视频**
    - 点击"播放"在浏览器中直接播放视频
    - 点击"下载"保存视频到本地
    - 点击"复制URL"将视频链接复制到剪贴板

### 智能播放策略

#### 播放优先级
1. **本地文件优先**: 如果已有本地文件，直接播放
2. **远程下载播放**: 先下载到output文件夹，再播放
3. **系统播放器**: 下载失败时回退到系统播放器
能列出本地output文件夹内的所有视频，做一个视频列表展示集成。


### 高级功能

12. **日志管理**
    - 在"操作日志"标签中查看所有操作记录
    - 点击"清空日志"清理日志显示
    - 点击"保存日志"导出日志到文本文件

13. **设置持久化**
    - 所有设置会自动保存到 `video_settings.json`
    - 下次启动时会自动加载配置

## 技术细节

### API 接口
- 使用 BizyAir 图片转视频API
- Web App ID: 39386
- 输出格式: MP4
- 最大超时时间: 10分钟

```python
# Python 示例代码
import requests
import json

url = "https://api.bizyair.cn/w/v1/webapp/task/openapi/create"
headers = {
    "Content-Type": "application/json",
    "Authorization": "Bearer YOUR_API_KEY"
}
data = {
      "web_app_id": 39386,
      "suppress_preview_output": False,
      "input_values": {
        "67:LoadImage.image": "https://bizyair-prod.oss-cn-shanghai.aliyuncs.com/inputs/20251111/iFTgLtreJQ53dXMsVxKv6mtwJcKpgH9g.png",
        "68:ImageResizeKJv2.width": 720,
        "68:ImageResizeKJv2.height": 720,
        "16:WanVideoTextEncode.positive_prompt": "美女跳舞",
        "89:WanVideoImageToVideoEncode.num_frames": 81
      }
    }

response = requests.post(url, headers=headers, json=data)
result = response.json()
print("生成结果:", result)
```

### 错误处理
- 自动重试机制
- 详细的错误日志记录
- 友好的错误提示信息

### 性能优化
- 使用独立线程处理API请求
- 不阻塞主界面操作
- 支持任务取消功能

## 注意事项

1. **API 密钥**: 确保已正确配置 SiliconCloud API 密钥
2. **网络连接**: 生成视频需要稳定的网络连接
3. **处理时间**: 视频生成可能需要较长时间，请耐心等待
4. **存储空间**: 生成的视频会保存历史记录，注意磁盘空间

## 文件说明

- `pic2vod.py`: 视频生成功能的主要实现文件
- `logs/video_generation.log`: 操作日志文件
- `video_history.json`: 历史生成记录文件
- 在主程序 `storyboard_generator.py` 中集成了视频生成Tab

## 更新日志

- v1.0: 初始版本，支持基本的图片转视频功能
- 添加了完整的用户界面和错误处理机制
- 集成了日志记录和历史管理功能